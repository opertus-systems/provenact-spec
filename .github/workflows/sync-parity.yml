name: sync-parity

on:
  pull_request:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  spec-cli-parity:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout provenact-spec
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
        with:
          path: provenact-spec

      - name: Checkout provenact-cli mirror
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
        with:
          repository: opertus-systems/provenact-cli
          path: provenact-cli

      - name: Run parity check
        shell: bash
        run: |
          chmod +x provenact-spec/tools/check-sync-parity.sh
          provenact-spec/tools/check-sync-parity.sh spec-cli "$GITHUB_WORKSPACE/provenact-cli"

      - name: Generate sync manifest
        shell: bash
        run: |
          chmod +x provenact-spec/tools/generate-sync-manifest.sh
          provenact-spec/tools/generate-sync-manifest.sh spec-cli "$GITHUB_WORKSPACE/provenact-cli" "$GITHUB_WORKSPACE/sync-manifest.spec-cli.json"

      - name: Upload sync manifest
        uses: actions/upload-artifact@b7c566a772e6b6bfb58ed0dc250532a479d7789f
        with:
          name: sync-manifest-spec-cli
          path: ${{ github.workspace }}/sync-manifest.spec-cli.json

  openapi-parity-skeleton:
    runs-on: ubuntu-latest
    if: ${{ false }}
    steps:
      - name: Placeholder
        run: |
          echo "Enable this job in provenact-control-web or dedicated integration repo."
