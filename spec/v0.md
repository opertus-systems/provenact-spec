# Provenact Composable Skills Spec (v0)

Status: legacy reference (non-normative). The active v0 contract is indexed in
`../SPEC.md`.

This document captures an earlier composable-skills v0 draft for secure,
deterministic, host-mediated skill composition in Provenact.

## 1. Goals

Provenact v0 MUST provide:

- deterministic, attestable execution of skills
- host-mediated composition (skills never directly call each other)
- least privilege using declared capabilities plus host enforcement
- replayable runs using immutable context snapshots and deltas
- production-grade controls for isolation, quotas, logging, policy, and
  supply-chain verification

## 2. Non-Goals (v0)

Provenact v0 does not include:

- distributed execution across multiple hosts
- dynamic skill discovery/marketplace logic
- direct skill-to-skill networking
- long-lived daemon/actor skills
- recursive autonomy or "agent spawns agent" execution

## 3. Core Objects

### 3.1 Skill

A skill package contains:

- `manifest.json`
- `skill.wasm`
- optional `policy.rego`
- optional `sbom.(spdx|cyclonedx).json`
- optional signature bundle(s)

Conceptual contract:

`(input, context_snapshot, declared_caps, env_snapshot) -> (output, delta, events, attestations)`

Skills have no ambient authority. All external interaction is mediated by
host-issued capability handles.

### 3.2 Run

A run is a single execution of a predeclared DAG with fixed policy and fixed
inputs over explicit context lineage.

A run produces:

- per-node outputs and deltas
- append-only event log
- host-signed attestation bundle
- optional transparency-log inclusion proof

### 3.3 Context

Context is immutable snapshots plus append-only deltas:

- skills read `ContextView`
- skills emit `ContextDelta`
- host validates and applies deltas to create the next snapshot

No shared mutable state is allowed.

## 4. Composition Model

- Skills MUST NOT call each other directly.
- The DAG MUST be declared up front and acyclic.
- Node IDs MUST be stable and unique.
- Node `skill` references MUST be exact-hash refs (`sha256:<hash>`), including
  pinned objects carrying optional source metadata.
- Edges MUST define explicit output-to-input mapping rules.
- Dynamic fan-out is not supported in v0.
- Default failure behavior is fail-fast (`abort`). `skip` is allowed per node.
  Retries are out of scope for v0.

## 5. Capability Model

Capabilities are declared by the skill, granted by policy, and enforced by host
on each invocation.

`effective_caps(node) = manifest_caps ∩ org_policy ∩ run_policy`

If a required capability is missing after intersection, the node MUST be
rejected before run start.

### 5.1 v0 Capability Classes

- Filesystem: `fs.read`, `fs.write`, `fs.temp`
- Network: `net.http` (domain/method/byte/time constraints)
- Time: `clock.read` (host may pin time for deterministic mode)
- Crypto: `crypto.hash` (`crypto.sign` is host-only)
- Key/value: `kv.get`, `kv.put`
- LLM proxy: `llm.call`
- HITL event emission: `hitl.request`

## 6. Hashing and Attestation Requirements

- Hash function: SHA-256
- Digest encoding: `sha256:<64 lowercase hex>`
- Canonical JSON hashing: RFC 8785 (JCS), UTF-8
- Event logs MUST be tamper-evident via hash chaining (`prev_hash` linkage)

The host attestation bundle MUST include at least:

- pipeline DAG hash
- skill artifact hash(es)
- policy hash
- per-node output hash + delta hash
- event-log head hash

## 7. Runtime and Isolation Requirements

In production-grade Linux deployments, each invocation MUST run in a separate
process and enforce:

- hard CPU/memory/time limits
- no ambient host networking
- minimal filesystem mounts (read-only by default)
- host-mediated I/O only

Resource breaches MUST hard-fail invocation and emit structured events.

## 8. v0 Locked Decisions

The following are mandatory for v0:

- no direct skill-to-skill calls
- predeclared DAG with no dynamic fan-out
- immutable context plus deltas
- fail-fast by default, optional skip, no retries
- capabilities granted as handles only (no ambient access)
- per-invocation process isolation
- event-chain integrity and host-signed attestation outputs

## 9. Schemas

Normative JSON schemas are provided in:

- `spec/v0/skill-manifest.schema.json`
- `spec/v0/pipeline.schema.json` (canonical alias for `pipeline-dag.schema.json`)

## 10. Conformance Vectors

v0 vectors for this contract are provided in `test-vectors/v0/` for:

- skill manifest parsing/validation
- pipeline parsing/validation
- event hash and chain verification
- capability resolution behavior
